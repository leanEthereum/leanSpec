[tox]
min_version = 4.0
requires =
    tox >=4.23.0,<5
    tox-uv >=1.29
env_list =
    all-checks
    pytest
    docs
skip_missing_interpreters = true
runner = uv-venv-lock-runner

[testenv]
basepython = python3.14
uv_python = >=3.12
allowlist_externals =
    pytest
    ruff
    mypy
    codespell
    mdformat
    mkdocs

[testenv:all-checks]
description = Run all quality checks (lint, typecheck, spellcheck, mdformat)
extras =
    lint
    typecheck
    test
    docs
    mdformat
commands =
    {[testenv:lint]commands}
    {[testenv:typecheck]commands}
    {[testenv:spellcheck]commands}
    {[testenv:mdformat]commands}

[testenv:lint]
description = Lint and code formatting checks (ruff)
extras = lint
commands =
    ruff check --no-fix --show-fixes src tests
    ruff format --check src tests

[testenv:fix]
description = Auto-fix linting and formatting issues (ruff)
extras = lint
commands =
    ruff check --fix src tests
    ruff format src tests

[testenv:typecheck]
description = Run type checking (mypy)
extras =
    typecheck
    test
commands = mypy src tests

[testenv:spellcheck]
description = Run spell checking (codespell)
extras = docs
commands = codespell src tests docs README.md CLAUDE.md --skip="*.lock,*.svg,.git,__pycache__,.mypy_cache,.pytest_cache" --ignore-words=.codespell-ignore-words.txt

[testenv:mdformat]
description = Check markdown formatting for docs (mdformat)
extras = mdformat
commands = mdformat docs/

[testenv:pytest]
description = Run tests (pytest)
extras = test
# parallelize with `auto` but keep max processes reasonable for CI
commands = pytest {posargs} tests -n auto --maxprocesses=10 --durations=10 --dist=worksteal

[testenv:pytest-cov]
description = Run tests with coverage (pytest)
extras = test
commands = pytest --cov --cov-report=html --cov-report=term {posargs}

[testenv:docs]
description = Serve documentation locally (mkdocs)
extras = docs
commands = mkdocs serve {posargs}

[testenv:docs-build]
description = Build documentation (mkdocs)
extras = docs
commands = mkdocs build {posargs}
