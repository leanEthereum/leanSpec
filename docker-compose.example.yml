# Example Docker Compose configuration for lean_spec
# Copy this to docker-compose.yml and adjust paths/settings as needed

services:
  # Test runner
  lean-spec-test:
    build:
      context: .
      target: runtime
    volumes:
      - .:/app
    command: uv run pytest -n auto

  # Consensus node - basic (passive sync)
  lean-spec-node-basic:
    build:
      context: .
      target: node
    ports:
      - "9000:9000"
    volumes:
      # Mount your genesis directory
      - /path/to/lean-quickstart/local-devnet/genesis:/app/data:ro
    environment:
      GENESIS_FILE: /app/data/genesis-lean-spec.json
      LISTEN_ADDR: /ip4/0.0.0.0/tcp/9000
      VERBOSE: "false"

  # Consensus node - with bootnode
  lean-spec-node-sync:
    build:
      context: .
      target: node
    ports:
      - "9001:9001"
    volumes:
      - /path/to/lean-quickstart/local-devnet/genesis:/app/data:ro
    environment:
      GENESIS_FILE: /app/data/genesis-lean-spec.json
      BOOTNODE: /ip4/127.0.0.1/tcp/9000
      LISTEN_ADDR: /ip4/0.0.0.0/tcp/9001
      VERBOSE: "true"

  # Validator node - zeam_0
  lean-spec-validator-zeam:
    build:
      context: .
      target: node
    ports:
      - "9010:9010"
    volumes:
      # Mount genesis directory with validator keys
      - /path/to/lean-quickstart/local-devnet/genesis:/app/data:ro
    environment:
      GENESIS_FILE: /app/data/genesis-lean-spec.json
      VALIDATOR_KEYS_PATH: /app/data
      NODE_ID: zeam_0
      BOOTNODE: /ip4/127.0.0.1/tcp/9000
      LISTEN_ADDR: /ip4/0.0.0.0/tcp/9010
      VERBOSE: "true"

  # Node with checkpoint sync
  lean-spec-node-checkpoint:
    build:
      context: .
      target: node
    ports:
      - "9020:9020"
    volumes:
      - /path/to/lean-quickstart/local-devnet/genesis:/app/data:ro
    environment:
      GENESIS_FILE: /app/data/genesis-lean-spec.json
      CHECKPOINT_SYNC_URL: http://host.docker.internal:5052
      VALIDATOR_KEYS_PATH: /app/data
      NODE_ID: zeam_0
      LISTEN_ADDR: /ip4/0.0.0.0/tcp/9020
      VERBOSE: "true"
    # Use host.docker.internal to access services on the host
    extra_hosts:
      - "host.docker.internal:host-gateway"
